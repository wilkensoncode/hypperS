{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wilkenson/Desktop/personalProject/eazyshopMern/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/wilkenson/Desktop/personalProject/eazyshopMern/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/wilkenson/Desktop/personalProject/eazyshopMern/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axios from\"axios\";import{PayPalButton}from\"react-paypal-button-v2\";import{Row,Col,ListGroup,Image,Card,Button}from\"react-bootstrap\";import{useDispatch,useSelector}from\"react-redux\";import Message from\"../components/message/Message\";import Loader from\"../components/loader/Loader\";import{getOrderDetails,payOrder,deliverOrder}from\"../redux/actions/Order\";import{Link}from\"react-router-dom\";import{CART_CLEAR_ITEMS}from\"../constants/cartConstants\";import{ORDER_PAY_RESET,ORDERS_DELIVER_RESET}from\"../constants/orderConstants\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Order=function Order(_ref){var match=_ref.match,history=_ref.history;var orderId=match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var dispatch=useDispatch();var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;if(!loading){var addDecimals=function addDecimals(num){return(Math.round(num*100)/100).toFixed(2);};order.itemsPrice=addDecimals(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));}useEffect(function(){if(!userInfo){history.push(\"/login\");}var addPayPalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get(\"/api/config/paypal\");case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement(\"script\");script.type=\"text/javascript\";script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref2.apply(this,arguments);};}();if(!order||successPay||successDeliver||order._id!==orderId){dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDERS_DELIVER_RESET});dispatch(getOrderDetails(orderId));}else if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}if(order.isPaid){dispatch({type:CART_CLEAR_ITEMS});}},[dispatch,order,orderId,successPay,successDeliver]);useEffect(function(){if(userInfo&&order.isPaid){history.push(\"/confirm\");dispatch({type:CART_CLEAR_ITEMS});}});var cart=useSelector(function(state){return state.cart;});var cartItems=cart.cartItems;var isCartEmpty=cartItems.reduce(function(acc,item){return acc+item.qty;},0);var handleSuccessPayment=function handleSuccessPayment(paymentResult){dispatch(payOrder(orderId,paymentResult));};var handleDeliver=function handleDeliver(){dispatch(deliverOrder(order));};return loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[order.isPaid&&isCartEmpty===0,/*#__PURE__*/_jsxs(\"h1\",{children:[\"Order \",order._id]}),/*#__PURE__*/_jsxs(Row,{className:\"d-flex justify-content-center\",children:[/*#__PURE__*/_jsxs(Col,{md:8,children:[/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),order.user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email: \"}),/*#__PURE__*/_jsx(\"a\",{href:\"mail:to\".concat(order.user.email),children:order.user.email})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address: \"}),order.shippingAddress.address,\",\",order.shippingAddress.city,\",\",order.shippingAddress.postalCode,\",\",order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\"Pick Up / Delivered on \",order.deliveredAt.substring(0,10)]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Delivered\"})]})}),\" \",/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method:\"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{variant:\"success\",children:[\"Paid on \",order.paidAt.substring(0,10)]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Paid\"})]})}),\" \",/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\"Order is empty\"}):/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),children:item.name})}),/*#__PURE__*/_jsxs(Col,{d:4,children:[item.qty,\" X $\",item.price,\" = \",item.qty*item.price]})]})},index);})})]})}),\" \"]}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h3\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\" Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.taxPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Total\"}),/*#__PURE__*/_jsxs(Col,{children:[\"$\",order.totalPrice]})]})}),!order.isPay&&/*#__PURE__*/_jsxs(ListGroup.Item,{children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),!sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:handleSuccessPayment})]}),loadingDeliver&&/*#__PURE__*/_jsx(Loader,{}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDeliver&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"button\",className:\"btn btn-block bg-primary\",onClick:handleDeliver,children:\"Mark As Delivered\"})})]})})})]})]});};export default Order;","map":{"version":3,"sources":["/Users/wilkenson/Desktop/personalProject/eazyshopMern/frontend/src/screen/Order.js"],"names":["React","useState","useEffect","axios","PayPalButton","Row","Col","ListGroup","Image","Card","Button","useDispatch","useSelector","Message","Loader","getOrderDetails","payOrder","deliverOrder","Link","CART_CLEAR_ITEMS","ORDER_PAY_RESET","ORDERS_DELIVER_RESET","Order","match","history","orderId","params","id","sdkReady","setSdkReady","dispatch","orderDetails","state","order","loading","error","userLogin","userInfo","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","addDecimals","num","Math","round","toFixed","itemsPrice","orderItems","reduce","acc","item","price","qty","push","addPayPalScript","get","clientId","data","script","document","createElement","type","src","async","onload","body","appendChild","_id","isPaid","window","paypal","cart","cartItems","isCartEmpty","handleSuccessPayment","paymentResult","handleDeliver","user","name","email","shippingAddress","address","city","postalCode","country","isDelivered","deliveredAt","substring","paymentMethod","paidAt","length","map","index","image","product","shippingPrice","taxPrice","totalPrice","isPay","isAdmin","isDeliver"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { PayPalButton } from \"react-paypal-button-v2\";\nimport { Row, Col, ListGroup, Image, Card, Button } from \"react-bootstrap\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Message from \"../components/message/Message\";\nimport Loader from \"../components/loader/Loader\";\n\nimport {\n  getOrderDetails,\n  payOrder,\n  deliverOrder,\n} from \"../redux/actions/Order\";\nimport { Link } from \"react-router-dom\";\nimport { CART_CLEAR_ITEMS } from \"../constants/cartConstants\";\nimport {\n  ORDER_PAY_RESET,\n  ORDERS_DELIVER_RESET,\n} from \"../constants/orderConstants\";\n\nconst Order = ({ match, history }) => {\n  const orderId = match.params.id;\n\n  const [sdkReady, setSdkReady] = useState(false);\n\n  const dispatch = useDispatch();\n\n  const orderDetails = useSelector((state) => state.orderDetails);\n  const { order, loading, error } = orderDetails;\n  const userLogin = useSelector((state) => state.userLogin);\n  const { userInfo } = userLogin;\n\n  const orderPay = useSelector((state) => state.orderPay);\n  const { loading: loadingPay, success: successPay } = orderPay;\n\n  const orderDeliver = useSelector((state) => state.orderDeliver);\n  const { loading: loadingDeliver, success: successDeliver } = orderDeliver;\n\n  if (!loading) {\n    const addDecimals = (num) => {\n      return (Math.round(num * 100) / 100).toFixed(2);\n    };\n\n    order.itemsPrice = addDecimals(\n      order.orderItems.reduce((acc, item) => acc + item.price * item.qty, 0)\n    );\n  }\n  useEffect(() => {\n    if (!userInfo) {\n      history.push(\"/login\");\n    }\n    const addPayPalScript = async () => {\n      const { data: clientId } = await axios.get(\"/api/config/paypal\");\n      const script = document.createElement(\"script\");\n      script.type = \"text/javascript\";\n      script.src = `https://www.paypal.com/sdk/js?client-id=${clientId}`;\n      script.async = true;\n      script.onload = () => {\n        setSdkReady(true);\n      };\n      document.body.appendChild(script);\n    };\n    if (!order || successPay || successDeliver || order._id !== orderId) {\n      dispatch({ type: ORDER_PAY_RESET });\n      dispatch({ type: ORDERS_DELIVER_RESET });\n      dispatch(getOrderDetails(orderId));\n    } else if (!order.isPaid) {\n      if (!window.paypal) {\n        addPayPalScript();\n      } else {\n        setSdkReady(true);\n      }\n    }\n    if (order.isPaid) {\n      dispatch({ type: CART_CLEAR_ITEMS });\n    }\n  }, [dispatch, order, orderId, successPay, successDeliver]);\n\n  useEffect(() => {\n    if (userInfo && order.isPaid) {\n      history.push(\"/confirm\");\n      dispatch({ type: CART_CLEAR_ITEMS });\n    }\n  });\n\n  const cart = useSelector((state) => state.cart);\n  const { cartItems } = cart;\n  const isCartEmpty = cartItems.reduce((acc, item) => acc + item.qty, 0);\n\n  const handleSuccessPayment = (paymentResult) => {\n    dispatch(payOrder(orderId, paymentResult));\n  };\n\n  const handleDeliver = () => {\n    dispatch(deliverOrder(order));\n  };\n  return loading ? (\n    <Loader />\n  ) : error ? (\n    <Message variant=\"danger\">{error}</Message>\n  ) : (\n    <>\n      {order.isPaid && (isCartEmpty===0)}\n      <h1>Order {order._id}</h1>\n      <Row className=\"d-flex justify-content-center\">\n        <Col md={8}>\n          <ListGroup variant=\"flush\">\n            <ListGroup.Item>\n              <h2>Shipping</h2>\n              <p>\n                <strong>Name:</strong>\n                {order.user.name}\n              </p>\n              <p>\n                <strong>Email: </strong>\n                <a href={`mail:to${order.user.email}`}>{order.user.email}</a>\n              </p>\n              <p>\n                <strong>Address: </strong>\n                {order.shippingAddress.address},{order.shippingAddress.city},\n                {order.shippingAddress.postalCode},\n                {order.shippingAddress.country}\n              </p>\n              {order.isDelivered ? (\n                <Message variant=\"success\">\n                  Pick Up / Delivered on {order.deliveredAt.substring(0, 10)}\n                </Message>\n              ) : (\n                <Message variant=\"danger\">Not Delivered</Message>\n              )}\n            </ListGroup.Item>\n          </ListGroup>{\" \"}\n          <ListGroup variant=\"flush\">\n            <ListGroup.Item>\n              <h2>Payment Method</h2>\n              <p>\n                <strong>Method:</strong>\n                {order.paymentMethod}\n              </p>\n              {order.isPaid ? (\n                <Message variant=\"success\">\n                  Paid on {order.paidAt.substring(0, 10)}\n                </Message>\n              ) : (\n                <Message variant=\"danger\">Not Paid</Message>\n              )}\n            </ListGroup.Item>\n          </ListGroup>{\" \"}\n          <ListGroup variant=\"flush\">\n            <ListGroup.Item>\n              <h2>Order Items</h2>\n              {order.orderItems.length === 0 ? (\n                <Message>Order is empty</Message>\n              ) : (\n                <ListGroup variant=\"flush\">\n                  {order.orderItems.map((item, index) => (\n                    <ListGroup.Item key={index}>\n                      <Row>\n                        <Col md={1}>\n                          <Image\n                            src={item.image}\n                            alt={item.name}\n                            fluid\n                            rounded\n                          />\n                        </Col>\n                        <Col>\n                          <Link to={`/product/${item.product}`}>\n                            {item.name}\n                          </Link>\n                        </Col>\n                        <Col d={4}>\n                          {item.qty} X ${item.price} = {item.qty * item.price}\n                        </Col>\n                      </Row>\n                    </ListGroup.Item>\n                  ))}\n                </ListGroup>\n              )}\n            </ListGroup.Item>\n          </ListGroup>{\" \"}\n        </Col>\n        <Col md={4}>\n          <Card>\n            <ListGroup>\n              <ListGroup.Item>\n                <h3>Order Summary</h3>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col> Items</Col>\n                  <Col>${order.itemsPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col> Shipping</Col>\n                  <Col>${order.shippingPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Tax</Col>\n                  <Col>${order.taxPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              <ListGroup.Item>\n                <Row>\n                  <Col>Total</Col>\n                  <Col>${order.totalPrice}</Col>\n                </Row>\n              </ListGroup.Item>\n              {!order.isPay && (\n                <ListGroup.Item>\n                  {loadingPay && <Loader />}\n                  {!sdkReady ? (\n                    <Loader />\n                  ) : (\n                    <PayPalButton\n                      amount={order.totalPrice}\n                      onSuccess={handleSuccessPayment}\n                    />\n                  )}\n                </ListGroup.Item>\n              )}\n              {loadingDeliver && <Loader />}\n              {userInfo &&\n                userInfo.isAdmin &&\n                order.isPaid &&\n                !order.isDeliver && (\n                  <ListGroup.Item>\n                    <Button\n                      type=\"button\"\n                      className=\"btn btn-block bg-primary\"\n                      onClick={handleDeliver}\n                    >\n                      Mark As Delivered\n                    </Button>\n                  </ListGroup.Item>\n                )}\n            </ListGroup>\n          </Card>\n        </Col>\n      </Row>\n    </>\n  );\n};\n\nexport default Order;\n"]},"metadata":{},"sourceType":"module"}